# yaml-language-server: $schema=https://linkml.io/linkml-model/linkml_model/jsonschema/meta.schema.json
id: http://kbase.github.io/cdm-schema/linkml/cdm_components

name: cdm_components
description: CDM schema components

imports:
  - linkml:types
  - cdm_attr_value
  - cdm_bioentity
  - cdm_credit
  - cdm_ontology
  - cdm_protocol

prefixes:
  kb_cdm: http://kbase.github.io/cdm-schema/linkml/
  linkml: https://w3id.org/linkml/
  mixs: https://genomicsstandardsconsortium.github.io/mixs/
  schema: http://schema.org/

default_curi_maps:
  - semweb_context
default_prefix: kb_cdm
default_range: string

slots:
  # slots used as identifiers
  association_id:
    description: Internal (CDM) unique identifier for an association.
    range: cdm_association_id
    required: true
  cluster_id:
    description: |
      Internal (CDM) unique identifier for a cluster.
      From the Entity table: entity_id where entity_type == 'Cluster'.
    range: cdm_cluster_id
    required: true
  event_id:
    description: Internal (CDM) unique identifier for an event.
    range: cdm_id
    required: true
  gold_environmental_context_id:
    description: Internal (CDM) unique identifier for a GOLD environmental context.
    range: cdm_id
    required: true
  mixs_environmental_context_id:
    description: Internal (CDM) unique identifier for a mixs environmental context.
    range: cdm_id
    required: true

classes:

  Association:
    is_a: Table
    aliases:
      - annotation
      - functional annotation
      - gene annotation
      - structural annotation
      - protein annotation
    slots:
      - association_id
      - subject
      - object
      - predicate
    slot_usage:
      association_id:
        identifier: true
      subject:
        description: The subject of an association.
        range: Any
        required: true
        any_of:
          - range: cdm_feature_id
          - range: cdm_encoded_feature_id
          - range: cdm_protein_id
          - range: cdm_contig_collection_id
      predicate:
        description: The relationship between subject and object in an association. Should be a term from the Relation Ontology.
        range: local_curie
        pattern: "^RO:\\d+$"
        required: true
      object:
        description: The object of an association. Should be an ontology term or database cross-reference.
        comments:
        - kb_cdm:Statement.subject
        range: local_curie
        required: true
    attributes:
      negated:
        description: If true, the relationship between the subject and object is negated. For example, consider an association where the subject is a protein ID, the object is the GO term for "glucose biosynthesis", and the predicate is "involved in". With the "negated" field set to false, the association is interpreted as "<protein ID> is involved in glucose biosynthesis". With the "negated" field set to true, the association is interpreted as "<protein ID> is not involved in glucose biosynthesis".
        range: boolean
        ifabsent: "false"
      evidence_type:
        aliases:
        - evidence code
        description: The type of evidence supporting the association. Should be a term from the Evidence and Conclusion Ontology (ECO). Specific pieces of evidence that support the association should be added as supporting objects, in the AssociationSupportingObject table.
        range: local_curie
        pattern: "^ECO:\\d+$"
      primary_knowledge_source:
        description: The knowledge source or contributor that created the association. Should be a CDM ID from the Contributor or DataSource table.
        range: cdm_contributor_id
      aggregator_knowledge_source:
        description: The knowledge source that aggregated the association. Should be a CDM ID from the Contributor or DataSource table.
        range: cdm_contributor_id
      annotation_date:
        description: The date when the annotation was made.
        range: iso8601
      comments:
        description: Any comments about the association.
        range: string
    description: An association between an object--typically an entity such as a protein or a feature--and a classification system or ontology, such as the Gene Ontology, the Enzyme Classification, or TIGRFAMS domains.

  Cluster:
    is_a: Table
    slots:
      - cluster_id
      - description
      - name
    slot_usage:
      cluster_id:
        identifier: true
      name:
        description: Name of the cluster, if available.
    attributes:
      entity_type:
        description: Type of entity being clustered.
        range: ClusterType
        required: true
        todos:
        - "This should be an enum: Protein, Feature, strain/species/other?"
      protocol_id:
        description: Protocol used to generate the cluster.
    description: Represents an individual execution of a clustering protocol. See the ClusterMember class for clustering results.

  ClusterMember:
    is_a: Table
    slots:
      - cluster_id
      - entity_id
    attributes:
      is_representative:
        range: boolean
        description: Whether or not this member is the representative for the cluster. If 'is_representative' is false, it is assumed that this is a cluster member.
        ifabsent: "false"
      is_seed:
        range: boolean
        description: Whether or not this is the seed for this cluster.
        ifabsent: "false"
      score:
        description: Output from the clustering protocol indicating how closely a member matches the representative.
        range: float
    description: Relationship representing membership of a cluster. An optional score can be assigned to each cluster member.

  Event:
    is_a: Table
    slots:
      - event_id
    slot_usage:
      event_id:
        identifier: true
    attributes:
      # conditions:
      #   description: TBD
      #   multivalued: true
      created_at:
        description: The time at which the event started or was created.
        range: iso8601
      description:
        description: Brief text description of what actually happened.
        todos:
        - Create controlled vocab for events?
      name:
        description: Name or title for the event.
      # gold_environmental_context:
      #   description: The environmental context for this event.
      #   range: GoldEnvironmentalContext
      # mixs_environmental_context:
      #   description: The environmental context for this event.
      #   range: MixsEnvironmentalContext
      location:
        description: The location for this event. May be described in terms of coordinates.
    description: Something that happened.

  GoldEnvironmentalContext:
    is_a: Table
    slots:
      - gold_environmental_context_id
    slot_usage:
      gold_environmental_context_id:
        identifier: true
    description: Environmental context, described using JGI's five level system.
    attributes:
      ecosystem:
        description: JGI GOLD descriptor representing the top level ecosystem categorization.
      ecosystem_category:
        description: JGI GOLD descriptor representing the ecosystem category.
      ecosystem_subtype:
        description: JGI GOLD descriptor representing the subtype of ecosystem. May be "Unclassified".
      ecosystem_type:
        description: JGI GOLD descriptor representing the ecosystem type. May be "Unclassified".
      specific_ecosystem:
        description: JGI GOLD descriptor representing the most specific level of ecosystem categorization. May be "Unclassified".

  MixsEnvironmentalContext:
    is_a: Table
    slots:
      - mixs_environmental_context_id
    slot_usage:
      mixs_environmental_context_id:
        identifier: true
    description: Environmental context, described using the MiXS convention of broad and local environment, plus the medium.
    attributes:
      env_broad_scale:
        annotations:
          expected_value:
            tag: expected_value
            value: The major environment type(s) where the sample was collected. Recommend subclasses of biome [ENVO:00000428]. Multiple terms can be separated by one or more pipes.
          tooltip: The biome or major environmental system where the sample or specimen originated. Choose values from subclasses of the 'biome' class [ENVO:00000428] in the Environment Ontology (ENVO). For host-associated or plant-associated samples, use terms from the UBERON or Plant Ontology to describe the broad anatomical or morphological context
        description: "Report the major environmental system the sample or specimen came from. The system(s) identified should have a coarse spatial grain, to provide the general environmental context of where the sampling was done (e.g. in the desert or a rainforest). We recommend using subclasses of EnvO's biome class: http://purl.obolibrary.org/obo/ENVO_00000428. EnvO documentation about how to use the field: https://github.com/EnvironmentOntology/envo/wiki/Using-ENVO-with-MIxS"
        title: broad-scale environmental context
        examples:
          - value: oceanic epipelagic zone biome [ENVO:01000033] for annotating a water sample from the photic zone in middle of the Atlantic Ocean
        from_schema: http://w3id.org/mixs/terms
        aliases:
          - broad-scale environmental context
        string_serialization: '{termLabel} {[termID]}'
        slot_uri: mixs:0000012
        range: uriorcurie
        multivalued: false
      env_local_scale:
        annotations:
          expected_value:
            tag: expected_value
            value: Environmental entities having causal influences upon the entity at time of sampling.
          tooltip: The specific environmental  entities or features near the sample or specimen that significantly influence its characteristics or composition. These entities are typically smaller in scale than the broad environmental context. Values for this field should be countable, material nouns and must be chosen from subclasses of BFO:0000040 (material entity) that appear in the Environment Ontology (ENVO). For host-associated or plant-associated samples, use terms from the UBERON or Plant Ontology to describe specific anatomical structures or plant parts.
        description: "Report the entity or entities which are in the sample or specimen's local vicinity and which you believe have significant causal influences on your sample or specimen. We recommend using EnvO terms which are of smaller spatial grain than your entry for env_broad_scale. Terms, such as anatomical sites, from other OBO Library ontologies which interoperate with EnvO (e.g. UBERON) are accepted in this field. EnvO documentation about how to use the field: https://github.com/EnvironmentOntology/envo/wiki/Using-ENVO-with-MIxS."
        title: local environmental context
        examples:
          - value: 'litter layer [ENVO:01000338]; Annotating a pooled sample taken from various vegetation layers in a forest consider: canopy [ENVO:00000047]|herb and fern layer [ENVO:01000337]|litter layer [ENVO:01000338]|understory [01000335]|shrub layer [ENVO:01000336].'
        from_schema: http://w3id.org/mixs/terms
        aliases:
          - local environmental context
        string_serialization: '{termLabel} {[termID]}'
        slot_uri: mixs:0000013
        range: uriorcurie
        multivalued: false
      env_medium:
        annotations:
          expected_value:
            tag: expected_value
            value: The material displaced by the entity at time of sampling. Recommend subclasses of environmental material [ENVO:00010483].
          tooltip: The predominant environmental material or substrate that directly surrounds or hosts the sample or specimen at the time of sampling. Choose values from subclasses of the 'environmental material' class [ENVO:00010483] in the Environment Ontology (ENVO). Values for this field should be measurable or mass material nouns, representing continuous environmental materials. For host-associated or plant-associated samples, use terms from the UBERON or Plant Ontology to indicate a tissue, organ, or plant structure
        description: "Report the environmental material(s) immediately surrounding the sample or specimen at the time of sampling. We recommend using subclasses of 'environmental material' (http://purl.obolibrary.org/obo/ENVO_00010483). EnvO documentation about how to use the field: https://github.com/EnvironmentOntology/envo/wiki/Using-ENVO-with-MIxS . Terms from other OBO ontologies are permissible as long as they reference mass/volume nouns (e.g. air, water, blood) and not discrete, countable entities (e.g. a tree, a leaf, a table top)."
        title: environmental medium
        examples:
          - value: 'soil [ENVO:00001998]; Annotating a fish swimming in the upper 100 m of the Atlantic Ocean, consider: ocean water [ENVO:00002151]. Example: Annotating a duck on a pond consider: pond water [ENVO:00002228]|air [ENVO_00002005]'
        from_schema: http://w3id.org/mixs/terms
        aliases:
          - environmental medium
        string_serialization: '{termLabel} {[termID]}'
        slot_uri: mixs:0000014
        range: uriorcurie
        multivalued: false

enums:
  ClusterType:
    description: The type of the entities in a cluster. Must be represented by a table in the CDM schema.
    permissible_values:
      Protein:
        meaning: kb_cdm:Protein
      Feature:
        meaning: kb_cdm:Feature
      ContigCollection:
        meaning: kb_cdm:ContigCollection
